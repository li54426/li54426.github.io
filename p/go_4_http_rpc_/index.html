<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="[TOC]\nctrl + /打开专注模式\nHTTp 框架 超文本传输协议 请求行/状态行 方法名 URL 协议版本 请求头/响应头 请求体/响应体 1 2 3 4 5 6 POST /sis HTTP/1.1 Who: Alex Content-Type: text/plain Host: 127.0.0.1:8888 Content-Length: 28 Let&#39;s watch a movie together 问题与展望 HTTP1 队头阻塞, 传输效率低, 明文传输不安全 (头部太大) HTTP2 多路复用, 头部压缩, 二进制协议 QUIC 基于 UDP 实现, 解决队头阻塞加, 密减少握手次数, 支持快速启动 盖尔定律 一个切实可行的复杂系统势必是从一个切实可行的简单系统发展而来的。从头开始设计的复杂系统根本不切实可行，无法修修补补让它切实可行。你必须由一个切实可行的简单系统重新开始。\n">
<title>Go_4_HTTP_RPC_</title>

<link rel='canonical' href='https://li54426.github.io/p/go_4_http_rpc_/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="Go_4_HTTP_RPC_">
<meta property='og:description' content="[TOC]\nctrl + /打开专注模式\nHTTp 框架 超文本传输协议 请求行/状态行 方法名 URL 协议版本 请求头/响应头 请求体/响应体 1 2 3 4 5 6 POST /sis HTTP/1.1 Who: Alex Content-Type: text/plain Host: 127.0.0.1:8888 Content-Length: 28 Let&#39;s watch a movie together 问题与展望 HTTP1 队头阻塞, 传输效率低, 明文传输不安全 (头部太大) HTTP2 多路复用, 头部压缩, 二进制协议 QUIC 基于 UDP 实现, 解决队头阻塞加, 密减少握手次数, 支持快速启动 盖尔定律 一个切实可行的复杂系统势必是从一个切实可行的简单系统发展而来的。从头开始设计的复杂系统根本不切实可行，无法修修补补让它切实可行。你必须由一个切实可行的简单系统重新开始。\n">
<meta property='og:url' content='https://li54426.github.io/p/go_4_http_rpc_/'>
<meta property='og:site_name' content='演示站点'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='byte_tech' /><meta property='article:tag' content='go' /><meta property='article:published_time' content='2023-07-31T11:02:06&#43;00:00'/><meta property='article:modified_time' content='2023-07-31T11:02:06&#43;00:00'/>
<meta name="twitter:title" content="Go_4_HTTP_RPC_">
<meta name="twitter:description" content="[TOC]\nctrl + /打开专注模式\nHTTp 框架 超文本传输协议 请求行/状态行 方法名 URL 协议版本 请求头/响应头 请求体/响应体 1 2 3 4 5 6 POST /sis HTTP/1.1 Who: Alex Content-Type: text/plain Host: 127.0.0.1:8888 Content-Length: 28 Let&#39;s watch a movie together 问题与展望 HTTP1 队头阻塞, 传输效率低, 明文传输不安全 (头部太大) HTTP2 多路复用, 头部压缩, 二进制协议 QUIC 基于 UDP 实现, 解决队头阻塞加, 密减少握手次数, 支持快速启动 盖尔定律 一个切实可行的复杂系统势必是从一个切实可行的简单系统发展而来的。从头开始设计的复杂系统根本不切实可行，无法修修补补让它切实可行。你必须由一个切实可行的简单系统重新开始。\n">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu15906844328442591646.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🍥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">演示站点</a></h1>
            <h2 class="site-description">我的个人博客。</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://li54426.github.io/en/" >English</option>
                                
                                    <option value="https://li54426.github.io/" selected>中文</option>
                                
                                    <option value="https://li54426.github.io/ar/" >عربي</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li>
      <ol>
        <li><a href="#http-框架">HTTp 框架</a>
          <ol>
            <li><a href="#超文本传输协议">超文本传输协议</a></li>
            <li><a href="#问题与展望">问题与展望</a></li>
            <li><a href="#盖尔定律">盖尔定律</a></li>
            <li><a href="#合理的-api">合理的 API</a></li>
            <li><a href="#什么是框架和中间件">什么是框架和中间件</a></li>
            <li><a href="#洋葱模型">洋葱模型</a></li>
            <li><a href="#什么是-handler">什么是 Handler</a></li>
            <li><a href="#开发流程">开发流程</a></li>
            <li><a href="#总结">总结</a></li>
            <li><a href="#设计点">设计点</a></li>
            <li><a href="#网络库比较">网络库比较</a></li>
            <li><a href="#针对协议的优化">针对协议的优化</a></li>
            <li><a href="#simd技术">SIMD技术</a></li>
            <li><a href="#性能不是全部">性能不是全部</a></li>
            <li><a href="#websocket">websocket</a></li>
          </ol>
        </li>
        <li><a href="#rpc框架">RPC框架</a>
          <ol>
            <li><a href="#什么是-rpc">什么是 RPC</a></li>
            <li><a href="#优缺点">优缺点</a></li>
            <li><a href="#分层设计">分层设计</a></li>
            <li><a href="#编码层如何选">编码层如何选</a></li>
          </ol>
        </li>
        <li><a href="#微服务">微服务</a>
          <ol>
            <li><a href="#软件架构定义">软件架构定义</a></li>
            <li><a href="#单体模式">单体模式</a></li>
            <li><a href="#分布式架构">分布式架构</a></li>
            <li><a href="#微服务架构">微服务架构</a></li>
            <li><a href="#微服务架构的三大要素">微服务架构的三大要素</a></li>
            <li><a href="#服务发布">服务发布</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/go_4_http_rpc_/">Go_4_HTTP_RPC_</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2023-07-31</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    阅读时长: 13 分钟
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>[TOC]</p>
<p><code>ctrl</code> + <code>/</code>打开专注模式</p>
<p><img src="/assets/image-20230731154712540.png"
	
	
	
	loading="lazy"
	
		alt="image-20230731154712540"
	
	
></p>
<h3 id="http-框架">HTTp 框架
</h3><h4 id="超文本传输协议">超文本传输协议
</h4><ul>
<li>请求行/状态行
<ul>
<li>方法名</li>
<li>URL</li>
<li>协议版本</li>
</ul>
</li>
<li><strong>请求头</strong>/响应头</li>
<li>请求体/响应体</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">POST /sis HTTP/1.1
</span></span><span class="line"><span class="cl">Who: Alex 
</span></span><span class="line"><span class="cl">Content-Type: text/plain 
</span></span><span class="line"><span class="cl">Host: 127.0.0.1:8888
</span></span><span class="line"><span class="cl">Content-Length: 28
</span></span><span class="line"><span class="cl">Let&#39;s watch a movie together
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="问题与展望">问题与展望
</h4><ul>
<li>HTTP1 队头阻塞, 传输效率低, 明文传输不安全  (头部太大)</li>
<li>HTTP2 多路复用, 头部压缩, 二进制协议</li>
<li>QUIC 基于 <strong>UDP</strong> 实现, 解决队头阻塞加, 密减少握手次数, 支持快速启动</li>
</ul>
<h4 id="盖尔定律">盖尔定律
</h4><p>一个切实可行的复杂系统势必是从一个切实可行的<strong>简单系统</strong>发展而来的。从头开始设计的复杂系统根本不切实可行，无法修修补补让它切实可行。你必须由一个切实可行的简单系统重新开始。</p>
<p>先 <code>run</code>起来, 再考虑复用, 使用<strong>迭代</strong>的方式进行</p>
<h4 id="合理的-api">合理的 API
</h4><p>不要试图在文档中说明,很多用户不看文档, 这也是在说: <strong>代码的自注释性</strong></p>
<ul>
<li>可理解性:如ctx.Body(),ctx.GetBody(),不要用ctx. BodyA()</li>
<li>简单性:如<code>ctx.Request. Header.Peek(key)</code>
/ctx. GetHeader(key)</li>
<li>冗余性</li>
<li>兼容性</li>
<li>可测性</li>
<li>可见性</li>
</ul>
<h4 id="什么是框架和中间件">什么是框架和中间件
</h4><p>在计算机编程和软件开发中，框架中间件（Framework Middleware）是指位于<strong>应用程序和底层框架</strong>之间的软件组件或功能模块。它提供了一种可插拔的方式，用于增强、定制或修改框架的行为，以满足特定的需求。</p>
<p>框架中间件在应用程序和底层框架之间充当了一个抽象层，用于处理和转换请求、响应以及其他相关的操作。它可以介入整个请求 - 响应周期，对数据进行预处理、后处理或者执行其他的附加操作。</p>
<p>框架中间件的主要作用有：</p>
<ol>
<li>路由和请求处理：中间件可以通过路由机制将请求分发给不同的处理程序，并执行相应的操作。它可以处理 URL 解析、参数提取、权限验证等任务。</li>
<li>数据转换和格式化：中间件可以对请求和响应的数据进行转换、验证和格式化。例如，可以将请求数据解析为特定的格式（如 JSON、XML），或者将响应数据转换为适合客户端的格式。</li>
<li>认证和授权：中间件可以处理用户身份认证和访问控制的任务。例如，它可以检查用户凭据、验证权限，决定是否允许用户继续执行操作。</li>
<li>缓存和性能优化：中间件可以在请求到达框架之前或之后，进行数据缓存、结果缓存以及其他的性能优化操作。它可以减少对底层资源的访问，提高应用程序的响应速度和性能。</li>
<li>日志记录和错误处理：中间件可以记录应用程序的运行日志，并处理异常情况和错误。它可以捕获和处理异常，记录错误信息，使得问题排查和故障修复更加方便有效。</li>
</ol>
<p>框架中间件的设计目标是提供灵活性和可扩展性，以满足不同应用程序的需求。通过使用框架中间件，开发人员可以以模块化的方式定制和增强框架的功能，使得应用程序的开发和维护更加容易和高效。</p>
<h4 id="洋葱模型">洋葱模型
</h4><p>适用场景:</p>
<ul>
<li>日志记录</li>
<li>性能统计</li>
<li>安全控制</li>
<li>事务处理</li>
<li>异常处理</li>
</ul>
<h4 id="什么是-handler">什么是 Handler
</h4><p>在计算机编程和软件开发中，Handler（处理器）是指用于处理特定事件或请求的代码块、函数或对象。它充当了一个中间人，接收来自外部系统或其它组件的事件或请求，并对其进行适当的处理和响应。</p>
<p>Handler 的主要任务是根据接收到的事件或请求的类型，执行相应的逻辑。它可以包括各种操作，如数据处理、错误处理、用户界面更新、网络通信、数据库查询等。</p>
<p>Handler 可以存在于不同的上下文中。例如，对于图形用户界面（GUI），一个按钮点击事件的处理者就是一个 Handler；在服务端开发中，一个 HTTP 请求的处理者也可以被称为 Handler。它们根据特定的事件或请求类型，执行相应的操作以满足需求。</p>
<p>在许多框架和库中，一般会有一套明确定义的规则和接口来定义和使用 Handler。这些规则和接口可以使开发人员更方便地定义和注册 Handler，并将其与相应的事件或请求关联起来。</p>
<p>总之，Handler 是用于处理特定事件或请求的代码块、函数或对象，它负责执行相关的逻辑以满足需求。通过合理的使用和组织 Handler，可以有效地管理和处理系统中的各种事件和请求。</p>
<p>框架路由实际上就是为URL匹配对应的处理函数(Handlers)</p>
<ul>
<li>
<p>静态路由:/a/b/c./a/b/d</p>
</li>
<li>
<p>参数路 :/a/:id/c(/a/b/c,/a/d/c)./*all</p>
</li>
<li>
<p>路由修复:</p>
<ul>
<li>如果只注册了 /a/b，但是访问的 URI 是 /a/b/，那可以提供自动重定向到 /a/b 能力；同样，如果只注册了 /a/b/，但是访问的 URI 是 /a/b，那可以提供自动重定向到 /a/b/ 能力</li>
</ul>
</li>
<li>
<p>冲突路由以及优先级</p>
<ul>
<li>同时注册 /a/b 和 /:id/b，并设定优先级。比如：当请求 URI 为 /a/b 时，优先匹配静态路由 /a/b</li>
</ul>
</li>
<li>
<p>匹配HTTP方法</p>
</li>
<li>
<p>多处理函数:方便添加中间件</p>
</li>
</ul>
<p>如何匹配HTTP方法</p>
<h4 id="开发流程">开发流程
</h4><ul>
<li>1.明确需求:考虑清楚要解决什么问题,有哪些需求</li>
<li>2.业界调研:业界都有哪些解决方案可供参考</li>
<li>3.方案权衡:思考不同方案的取舍</li>
<li>4.方案评审:相关同学对不同方案做评审</li>
<li>5.确定开发:确定最合适的方案进行开发</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Server</span> <span class="kd">interface</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nf">Serve</span><span class="p">(</span><span class="nx">c</span> <span class="nx">context</span><span class="p">.</span> <span class="nx">Context</span><span class="p">,</span> <span class="nx">conn</span> <span class="nx">network</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span> <span class="kt">error</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Conn</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Read</span><span class="p">(</span><span class="nx">b</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Write</span><span class="p">(</span><span class="nx">b</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="link" href="https://github.com/cloudwego/netpoll"  target="_blank" rel="noopener"
    >字节内部网络模型</a></p>
<h4 id="总结">总结
</h4><ul>
<li>API设计:可理解性、简单性</li>
<li>中间件设计: 洋葱模型</li>
<li>路由设计:前缀匹配树</li>
<li>协议层设计:抽象出合适的接口</li>
<li>网络层设计: 网络模型</li>
</ul>
<h4 id="设计点">设计点
</h4><ul>
<li>存下全部Header</li>
<li>减少系统调用次数</li>
<li>能够复用内存</li>
<li>能够多次读</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Reader</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 开始读的位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">Peek</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Discard</span><span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">)(</span><span class="nx">discarded</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Release</span><span class="p">()</span> <span class="kt">error</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">Size</span><span class="p">()</span> <span class="kt">int</span> 
</span></span><span class="line"><span class="cl">    <span class="nf">Read</span><span class="p">(</span><span class="nx">b</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)(</span><span class="nx">l</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="网络库比较">网络库比较
</h4><ul>
<li><code>go net </code>  流式友好, 小包性能高</li>
<li><code>netpoll</code> 中大包性能高, 时延低</li>
</ul>
<h4 id="针对协议的优化">针对协议的优化
</h4><ul>
<li>找到Header Line边界:<code>\r\n</code>, 先找到<code>\n</code>再看它前一个是不是<code>\r</code></li>
<li>热点资源<strong>池化</strong></li>
</ul>
<p>针对协议相关的Headers</p>
<ul>
<li>1.通过 Header key 首字母快速筛除掉完全<strong>不可能</strong>的 key</li>
<li>2.解析对应 value到独立字段</li>
<li>3.使用 byte slice 管理对应 header 存储,方便复用请求体中同样处理的Key:
User-Agent、 Content-Type、 Content-Length、 Connection、 Transfer-Encoding</li>
</ul>
<p><a class="link" href="https:/github.com/bytedance/sonic"  target="_blank" rel="noopener"
    >开源 json 库</a></p>
<h4 id="simd技术">SIMD技术
</h4><p>SIMD（Single Instruction, Multiple Data）是一种<strong>并行计算</strong>的技术，它在同一时间执行相同的指令来处理多个数据元素。它是在计算机体系结构中用于向量化操作的一种方式。</p>
<p>传统的计算机指令集架构（ISA）以标量方式执行指令，即每次执行一个指令处理一个数据元素。而 SIMD 架构通过引入特殊的寄存器和指令集，能够同时处理多个数据元素，加速并行计算。</p>
<p>SIMD 技术适用于那些可以<strong>被划分为多个独立任务</strong>的数据，并且这些任务可以并行地进行相同的计算。它可以提高多媒体处理、图形渲染、信号处理、科学计算等应用的性能。</p>
<p>SIMD 指令集提供了一系列的指令，用于在单个时钟周期内同时对多个数据进行相同的操作。这些指令可以一次性处理多个数据元素，例如同时对四个浮点数执行加法操作。</p>
<p>常见的 SIMD 指令集包括 Intel 的 SSE（Streaming SIMD Extensions）、AMD 的 3DNow!、ARM 的 NEON 等。这些指令集通常有不同的版本，支持不同的宽度（如 128 位、256 位）和数据类型（如整数、浮点数）。</p>
<p>使用 SIMD 技术可以显著提高计算性能，但需要合理的程序设计和优化以充分利用 SIMD 指令集的并行计算能力。许多编程语言和编译器提供了对 SIMD 的支持，使得开发者能够方便地利用 SIMD 技术来加速计算。</p>
<h4 id="性能不是全部">性能不是全部
</h4><ul>
<li>追求性</li>
<li>追求易用, 减少误用</li>
<li>打通内部生态</li>
<li>文档建设、用户群建设,</li>
</ul>
<h4 id="websocket">websocket
</h4><p>我们知道 TCP 连接的两端，<strong>同一时间里</strong>，<strong>双方</strong>都可以<strong>主动</strong>向对方发送数据。这就是所谓的<strong>全双工</strong>。而现在使用最广泛的 <code>HTTP/1.1</code>，也是基于 TCP 协议的，<strong>同一时间里</strong>，客户端和服务器<strong>只能有一方主动</strong>发数据，这就是所谓的<strong>半双工</strong>。</p>
<p>这是由于 HTTP 协议设计之初，考虑的是看看网页文本的场景，能做到<strong>客户端发起请求再由服务器响应</strong>，就够了，根本就没考虑网页游戏这种，客户端和服务器之间都要互相主动发大量数据的场景。</p>
<p>所以，为了更好的支持这样的场景，我们需要另外一个<strong>基于 TCP 的新协议</strong>。</p>
<p>于是新的应用层协议 <strong>WebSocket</strong> 就被设计出来了。</p>
<p>我们平时刷网页，一般都是在浏览器上刷的，一会刷刷图文，这时候用的是 <strong>HTTP 协议</strong>，一会打开网页游戏，这时候就得切换成我们新介绍的 <strong>WebSocket 协议</strong>。</p>
<p>为了兼容这些使用场景。浏览器在 <strong>TCP 三次握手</strong>建立连接之后，都<strong>统一使用 HTTP 协议</strong>先进行一次通信。</p>
<ul>
<li>如果此时是<strong>普通的 HTTP 请求</strong>，那后续双方就还是老样子继续用普通 HTTP 协议进行交互，这点没啥疑问。</li>
<li>如果这时候是<strong>想建立 WebSocket 连接</strong>，就会在 HTTP 请求里带上一些<strong>特殊的 header 头</strong>，如下：</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="err">Connection: Upgrade
</span></span></span><span class="line"><span class="cl"><span class="err">Upgrade: WebSocket
</span></span></span><span class="line"><span class="cl"><span class="err">Sec-WebSocket-Key: T2a6wZlAwhgQNqruZ2YUyg==\r\n
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这些 header 头的意思是，浏览器想<strong>升级协议（Connection: Upgrade）</strong>，并且<strong>想升级成 WebSocket 协议（Upgrade: WebSocket）</strong>。同时带上一段<strong>随机生成的 base64 码（Sec-WebSocket-Key）</strong>，发给服务器。</p>
<p>如果服务器正好支持升级成 WebSocket 协议。就会走 WebSocket 握手流程，同时根据客户端生成的 base64 码，用某个<strong>公开的</strong>算法变成另一段字符串，放在 HTTP 响应的 <code>Sec-WebSocket-Accept</code> 头里，同时带上 <code>101状态码</code>，发回给浏览器。HTTP 的响应如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-http" data-lang="http"><span class="line"><span class="cl"><span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">101</span> <span class="ne">Switching Protocols\r\n</span>
</span></span><span class="line"><span class="cl"><span class="n">Sec-WebSocket-Accept</span><span class="o">:</span> <span class="l">iBJKv/ALIW2DobfoA4dmr3JHBCY=\r\n</span>
</span></span><span class="line"><span class="cl"><span class="n">Upgrade</span><span class="o">:</span> <span class="l">WebSocket\r\n</span>
</span></span><span class="line"><span class="cl"><span class="n">Connection</span><span class="o">:</span> <span class="l">Upgrade\r\n</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="rpc框架">RPC框架
</h3><h4 id="什么是-rpc">什么是 RPC
</h4><p>RPC（Remote Procedure Call）是一种用于实现<strong>分布式</strong>系统通信的协议和机制。它允许一个进程（客户端）调用另一个运行在不同地址空间的进程（服务器）中的函数或方法，就像调用本地函数一样。</p>
<p>RPC 的工作原理如下：</p>
<ol>
<li>客户端通过本地调用的方式调用远程服务器的函数或方法。</li>
<li>客户端的 RPC stub（存根）将调用信息打包成网络可传输的消息，并发送给远程服务器。</li>
<li>服务器的 RPC stub 接收到消息后，解包调用信息并调用对应的函数或方法。</li>
<li>函数或方法执行完毕后，将结果打包成响应消息，并发送给客户端。</li>
<li>客户端的 RPC stub 接收到响应消息后，解包结果并返回给本地调用方。</li>
</ol>
<p>通过 RPC，开发人员可以轻松地在分布式系统中调用远程服务，而无需关心底层的网络通信细节。它隐藏了网络通信的复杂性，使得分布式系统开发更加方便和高效。</p>
<p>RPC 的优势包括：</p>
<ol>
<li>简化分布式系统开发：RPC 提供了一种简单而直观的方法来调用远程服务，使得分布式系统开发更加容易和高效。</li>
<li>高效的网络通信：RPC 可以使用高效的序列化和网络传输协议，以最小的开销在分布式系统间传递数据。</li>
<li>抽象底层细节：RPC 抽象了底层的网络通信细节，使得开发人员可以更专注于业务逻辑的实现，而不用关心底层通信协议和传输细节。</li>
</ol>
<p>常见的 RPC 框架包括 gRPC、Apache Thrift、Spring Cloud、Dubbo 等。这些框架提供了丰富的功能和工具，使得分布式系统的开发、部署和管理更加便捷和可靠。</p>
<p>和 <code>HTTP</code> 对比起来</p>
<ul>
<li>HTTP 信息非常的冗余,</li>
<li>而 RPC，因为它定制化程度更高，因此性能也会更好一些，这也是在公司<strong>内部微服务</strong>中抛弃 HTTP，选择使用 RPC 的最主要原因。</li>
<li>当然上面说的 HTTP，其实<strong>特指的是现在主流使用的 HTTP/1.1</strong>，<code>HTTP/2</code> 在前者的基础上做了很多改进，所以<strong>性能可能比很多 RPC 协议还要好</strong>，甚至连 <code>gRPC</code> 底层都直接用的 <code>HTTP/2</code>。那么问题又来了，为什么既然有了 HTTP/2，还要有 RPC 协议？这个是由于 HTTP/2 是 2015 年出来的。那时候很多公司内部的 RPC 协议都已经跑了好些年了，基于<strong>历史原因</strong>，一般也没必要去换了</li>
</ul>
<p>RPC需要解决的问题</p>
<ul>
<li>1 函数<strong>映射</strong></li>
<li>2.数据<strong>转换</strong>成字节流</li>
<li>3.网络传输</li>
</ul>
<p>RPC 的概念模型：</p>
<ul>
<li>User、</li>
<li>User-Stub、</li>
<li>RPC-Runtime、</li>
<li>Server-Stub、</li>
<li>Server</li>
</ul>
<h4 id="优缺点">优缺点
</h4><p>优点</p>
<ul>
<li>单一职责,有利于分工协作和运维开发</li>
<li>可扩展性强, 资源使用率更优</li>
<li>故障隔离, 服务的整体可靠性更高</li>
</ul>
<p>坏处</p>
<ul>
<li>1.服务宕机,对方应该如何处理?</li>
<li>2.在调用过程中发生网络异常,如何保证消息的可达性?</li>
<li>3.请求量突增导致服务无法及时处理, 有哪些应对措施?</li>
</ul>
<h4 id="分层设计">分层设计
</h4><ul>
<li>
<p>编解码层 包括生成代码</p>
</li>
<li>
<p>协议层</p>
</li>
<li>
<p>网络层</p>
</li>
<li>
<p>语言特定的格式</p>
<ul>
<li>许多编程语言都内建了将内存对象编码为字节序列的支持,例如Java有java.io.Serializable</li>
</ul>
</li>
<li>
<p>文本格式JSON、XML、CSV等文本格式,具有人类可读性</p>
</li>
<li>
<p>二进制编码, 具备跨语言和高性能等优点,常见有Thrift的 BinaryProtocol, Protobuf</p>
</li>
</ul>
<p>TLV编码</p>
<ul>
<li>Tag:标签,可以理解为类型</li>
<li>Lenght:长度</li>
<li>Value:值,Value也可以是个TLV结构</li>
</ul>
<p>增加了冗余信息</p>
<h4 id="编码层如何选">编码层如何选
</h4><ul>
<li>兼容性, 支持自动增加新的字段,而不影响老的服务,这将提高系统的灵活度</li>
<li>通用性支持跨平台、跨语言</li>
<li>性能从空间和时间两个维度来考虑,也就是编码后<strong>数据大小</strong>和<strong>编码耗费时长</strong></li>
</ul>
<h3 id="微服务">微服务
</h3><p>微服务架构是当前大多数互联网公司的<strong>标准架构</strong>.</p>
<h4 id="软件架构定义">软件架构定义
</h4><p>​     软件架构是构建应用系统所需要的一组结构，包括软件元素、<strong>元素之间的关系</strong>以及两者的属性。其中如何分解软件元素以及这些元素之间的关系，变得非常重要。一个好的软件架构具备两个特点:</p>
<ul>
<li>合理调配生产关系与生产力，让具备不同专业知识与技术栈的的人士都参与到软件系统开发中来， 高效地协同工作；</li>
<li>能让各个软件元素有清晰的定义与职责，并有一套良好、高效的交互机制.</li>
</ul>
<p>为什么系统架构需要演进?</p>
<ul>
<li>互联网的爆炸性发展</li>
<li>硬件设施的快速发展</li>
<li>需求复杂性的多样化开发人员的急剧增加</li>
<li>计算机理论及技术的发展</li>
</ul>
<h4 id="单体模式">单体模式
</h4><p>all in one process</p>
<p>优势</p>
<ul>
<li>1.性能最高</li>
<li>2冗余小</li>
</ul>
<p>劣势:</p>
<p>1.debug
2.模块相互影响
3.模块分工、开发流程</p>
<h4 id="分布式架构">分布式架构
</h4><p>抽出业务无关的公共模块, 服务层</p>
<p>优势:
1.业务无关的独立服务</p>
<p>劣势:</p>
<ul>
<li>1.服务模块bug可导致全站瘫痪</li>
<li>2.调用关系复杂</li>
<li>3.不同服务冗余</li>
</ul>
<h4 id="微服务架构">微服务架构
</h4><p>在讲述微服务架构之前一定要讲下经典的扩展立方体理论，扩展立方体定义了三种不同的扩展应用程序的方法：</p>
<ul>
<li>
<p>X 轴扩展在多个相同实例之间实现请求的负载均衡；</p>
</li>
<li>
<p>Y 轴扩展根据功能将应用程序拆分为服务；</p>
</li>
<li>
<p>Z 轴扩展根据请求的属性路由请求.</p>
</li>
<li>
<p>X扩展,称为水平复制,通过克隆实例的方式发展</p>
</li>
<li>
<p>Y轴扩展,又称为功能性分解,通过不同</p>
</li>
<li>
<p>Z轴扩展,又称为数据分区,通过类似客户ID的方式,把相同的数据分区进行扩展</p>
</li>
</ul>
<p>微服务架构其实可以理解为” 模块化设计 &ldquo;的扩展延伸，只是这些&rdquo; 功能模块 &quot; 以单独的部署包的方式运行在各自的进程中。这样每个服务之间都是相互独立的，并且有自己的<strong>私有数据库</strong>，两者之间仅能通过 <strong>API</strong> 的方式进行通信。</p>
<p>从单体架构到微服务架构的演进也带来了以下好处:</p>
<ul>
<li>从代码管理来看，每个服务较小，大部分由于十几个接口或服务方法组成，非常容易<strong>维护</strong>；</li>
<li>从运维管理来看，每个服务都可以独立部署，非常易于<strong>扩展</strong>；</li>
<li>从团队管理来看，可以更好地划分职责范围；</li>
<li>从软件开发总体来看，可以使软件系统可持续性交付部署.</li>
</ul>
<p>彻底的服务化优势:</p>
<ul>
<li>1.开发效率</li>
<li>2.业务独立设计</li>
<li>3.自下而上</li>
<li>4.故障隔离</li>
</ul>
<p>劣势:</p>
<ul>
<li>1.治理、运维难度</li>
<li>2.观测挑战</li>
<li>3.安全性</li>
<li>4.分布式系统</li>
</ul>
<p>微服务架构概览</p>
<ul>
<li>网关</li>
<li>服务配置和治理</li>
<li>链路追踪和监控</li>
</ul>
<h4 id="微服务架构的三大要素">微服务架构的三大要素
</h4><ul>
<li>
<p>服务治理（本课程内容）</p>
<ul>
<li>服务注册</li>
<li>服务发现</li>
<li>负载均衡</li>
<li>扩缩容</li>
<li>流量治理</li>
<li>稳定性治理</li>
</ul>
</li>
<li>
<p>可观测性</p>
<ul>
<li>日志采集</li>
<li>日志分析</li>
<li>监控打点</li>
<li>监控大盘</li>
<li>异常报警</li>
<li>链路追踪</li>
</ul>
</li>
<li>
<p>安全</p>
<ul>
<li>身份验证</li>
<li>认证授权</li>
<li>访问令牌</li>
<li>审计</li>
<li>传输加密</li>
<li>黑产攻击</li>
</ul>
</li>
</ul>
<p>服务service</p>
<ul>
<li>一组具有<strong>相同逻辑</strong> (同一份代码) 的运行实体.</li>
</ul>
<p>实例与进程的关系</p>
<ul>
<li>实例与进程之间没有必然对应关系,可以一个实例可以对应一个或多个进程(反之不常见).</li>
</ul>
<p>常见的实例承载形式</p>
<ul>
<li>进程、VM、k8spod…</li>
</ul>
<p>有状态/无状态服务</p>
<ul>
<li>服务的实例是否存储了可持久化的数据(例如磁盘文件).</li>
</ul>
<p>服务间通信</p>
<ul>
<li>对于单体服务,不同模块通信只是简单的函数调用</li>
<li>对于微服务,服务间通信意味着<strong>网络传输</strong></li>
</ul>
<p>使用微服务架构的应用程序是分布式系统，进程间通信是重要组成部分，有以下几种通信模式:</p>
<ul>
<li>通信风格：使用哪一种的进程间通信机制；</li>
<li>服务发现：客户端如何获得具体实例的真实 IP 地址；</li>
<li>可靠性：在服务不可用的情况下，如何确保服务之间的可靠通信；</li>
<li>事务性消息：如何将消息发送、事件发布、更新业务数据的数据库事务集成；</li>
<li>外部 API: 应用客户端如何与服务通信.</li>
</ul>
<p>问题</p>
<p>在代码层面,如何指定调用一个目标服务的地址(ip:port)</p>
<ul>
<li>地址会变</li>
<li>有多个地址</li>
</ul>
<p>使用 DNS 解决</p>
<ul>
<li>本地DNS存在缓存,导致延时.</li>
<li>负载均衡问题. 大部分会只访问第一个</li>
<li>不支持服务实例的探活检查.</li>
<li>域名无法配置端口. 必须约定端口</li>
</ul>
<p>解决思路:新增一个统一的<strong>服务注册</strong>中心, 用于存储服务名到服务实例的映射.</p>
<h4 id="服务发布">服务发布
</h4><p>问题</p>
<ul>
<li>服务不可用</li>
<li>服务抖动</li>
<li>服务回滚</li>
</ul>
<p>方法</p>
<ul>
<li>蓝绿部署&mdash;简单,稳定但需要两倍资源</li>
<li>灰度发布&mdash;一点一点替换, 回滚操作比较难</li>
</ul>
<p>防止链路重试链路层面的防重试风暴的核心是限制每层都发生重试,理想情况下只有最下一层发生重试.
可以返回特殊的status表明&quot;请求失败,但别重试&quot;.</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/byte_tech/">Byte_tech</a>
        
            <a href="/tags/go/">Go</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/go_%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E9%9B%B6%E6%8B%B7%E8%B4%9D%E5%8F%8A%E5%BA%94%E7%94%A8/">
        
        

        <div class="article-details">
            <h2 class="article-title">Go_深入浅出零拷贝及应用</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/go_quick_book/">
        
        

        <div class="article-details">
            <h2 class="article-title">Go_quick_book</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/%E6%BC%8F%E6%B4%9E/">
        
        

        <div class="article-details">
            <h2 class="article-title">漏洞</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/go_/">
        
        

        <div class="article-details">
            <h2 class="article-title">Go_</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/go_/">
        
        

        <div class="article-details">
            <h2 class="article-title">Go_</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 Example Person
    </section>
    
    <section class="powerby">
        使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.27.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
